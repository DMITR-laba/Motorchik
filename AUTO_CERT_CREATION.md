# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–æ–º–µ–Ω–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç** (–µ—Å–ª–∏ –æ–Ω –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç).

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–æ–º–µ–Ω–∞

1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–æ–º–µ–Ω–∞** ‚Üí `_save_domain_settings(domain)`
2. **–°–æ–∑–¥–∞–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞** ‚Üí `_create_ssl_certificate(domain)` ‚≠ê **–ù–û–í–û–ï**
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx** ‚Üí `_update_nginx_config(domain)`
4. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ Nginx** ‚Üí `_reload_nginx()` (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)

## üìç –ì–¥–µ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤:
```
certbot/conf/live/{domain}/fullchain.pem
certbot/conf/live/{domain}/privkey.pem
```

–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –¥–æ–º–µ–Ω–∞ `app.domain`:
```
certbot/conf/live/app.domain/fullchain.pem
certbot/conf/live/app.domain/privkey.pem
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§—É–Ω–∫—Ü–∏—è `_create_ssl_certificate(domain)`

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è –¥–æ–º–µ–Ω–∞
- –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ
- –ï—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí —Å–æ–∑–¥–∞–µ—Ç —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —á–µ—Ä–µ–∑ `openssl`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç RSA 4096 –±–∏—Ç, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è 365 –¥–Ω–µ–π
- –í–∫–ª—é—á–∞–µ—Ç Subject Alternative Names (SAN): –¥–æ–º–µ–Ω, *.–¥–æ–º–µ–Ω, 127.0.0.1

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- `openssl` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ ‚úÖ (–¥–æ–±–∞–≤–ª–µ–Ω –≤ Dockerfile)
- –î–æ—Å—Ç—É–ø –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `certbot/conf` ‚úÖ (–¥–æ–±–∞–≤–ª–µ–Ω volume –≤ docker-compose.yml)

## üìã –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚Üí –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞
2. –í–≤–µ–¥–∏—Ç–µ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: `myapp.com`)
3. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–æ–º–µ–Ω"
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
   - –°–æ–∑–¥–∞–µ—Ç—Å—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è `myapp.com`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ: "–î–æ–º–µ–Ω 'myapp.com' —Å–æ—Ö—Ä–∞–Ω–µ–Ω, SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–æ–∑–¥–∞–Ω"

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Ö –µ—â–µ –Ω–µ—Ç
- –°–æ–∑–¥–∞—é—Ç—Å—è **—Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ** —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Let's Encrypt —á–µ—Ä–µ–∑ certbot
- –ï—Å–ª–∏ openssl –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

## üîç –õ–æ–≥–∏

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –≤ –ª–æ–≥–∞—Ö backend –±—É–¥–µ—Ç:
```
INFO:app.api.domain_api:‚úÖ –°–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –¥–æ–º–µ–Ω–∞ 'myapp.com'
INFO:app.api.domain_api:   –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç: /app/../certbot/conf/live/myapp.com/fullchain.pem
INFO:app.api.domain_api:   –ö–ª—é—á: /app/../certbot/conf/live/myapp.com/privkey.pem
```

