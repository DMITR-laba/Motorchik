# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–∞–¥ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º ‚úÖ

**–î–∞—Ç–∞:** 2025-11-16

---

## ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞

**–ë—ã–ª–æ:** –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∏–º–µ–ª –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏–∑ `ai_settings.json`

**–°—Ç–∞–ª–æ:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `ai_settings.json` –∏–º–µ—é—Ç –≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. `rag_service.py` - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ ‚úÖ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `ai_settings.json`
- –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
- –ü—Ä–∏ –æ—à–∏–±–∫–µ Mistral –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ Ollama

**–ö–æ–¥:**
```python
# –ü–†–ò–û–†–ò–¢–ï–¢: –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ ai_settings.json
response_model = ai_settings.get("response_model", "")

# –ï—Å–ª–∏ –º–æ–¥–µ–ª—å —É–∫–∞–∑–∞–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
if response_model and response_model.strip():
    print(f"‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫: {response_model}")
    # ... –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ model_info ...
# –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
elif use_orchestrator and not deep_thinking_enabled:
    # ... –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ...
```

---

### 2. `ai_model_orchestrator_service.py` - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ `select_model_for_task` ‚úÖ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ `ai_settings.json` –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `user_override` > `ai_settings.json` > –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–ö–æ–¥:**
```python
# 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º user_override (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
if user_override and user_override.strip():
    return user_override

# 2. –ü–†–ò–û–†–ò–¢–ï–¢: –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ ai_settings.json
for settings_path in ai_settings_paths:
    if os.path.exists(settings_path):
        ai_settings = json.load(f)
        response_model = ai_settings.get("response_model", "")
        if task_key == "response_generation" and response_model:
            return response_model

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
# 4. –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á)
```

---

### 3. `sql_agent_service.py` - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è SQL –º–æ–¥–µ–ª–µ–π ‚úÖ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `sql_agent_settings.json` –∏ `ai_settings.json`
- –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä

**–ö–æ–¥:**
```python
# –ü–†–ò–û–†–ò–¢–ï–¢ 1: –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
sql_model = self._get_sql_agent_model()

# –ï—Å–ª–∏ –º–æ–¥–µ–ª—å —É–∫–∞–∑–∞–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë
if sql_model and sql_model.strip():
    print(f"‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å SQL –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫: {sql_model}")
    return sql_model

# –ü–†–ò–û–†–ò–¢–ï–¢ 2: –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
selected_model = await orchestrator.select_model_for_task(...)
```

---

### 4. Fallback –Ω–∞ Ollama –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö Mistral ‚úÖ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ü—Ä–∏ –æ—à–∏–±–∫–µ Mistral –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–±—É–µ—Ç—Å—è Ollama
- Fallback —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Mistral

**–ö–æ–¥:**
```python
try:
    response = await _generate_with_mistral_async(model_name, api_key, prompt)
    return response, model_info
except Exception as mistral_err:
    # –ü—Ä–∏ –æ—à–∏–±–∫–µ Mistral –ø—Ä–æ–±—É–µ–º Ollama
    print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ Mistral: {mistral_err}, –ø—Ä–æ–±—É–µ–º Ollama...")
    try:
        response = await _generate_with_ollama_async("llama3:8b", prompt)
        return response, model_info
    except Exception as ollama_err:
        # –ï—Å–ª–∏ –∏ Ollama –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É
        return f"–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ...", model_info
```

---

## üìã –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–æ—Ç –≤—ã—Å—à–µ–≥–æ –∫ –Ω–∏–∑—à–µ–º—É)

1. **`user_override`** (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω —è–≤–Ω–æ)
2. **`ai_settings.json`** ‚Üí `response_model` (–¥–ª—è `response_generation`)
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** –∏–∑ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
4. **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä** (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á –∏–∑ `ai_model_config.json`)

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å –∏–∑ ai_settings.json –¥–ª—è response_generation: mistral:mistral-large-latest
‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ –ù–ê–°–¢–†–û–ï–ö –†–ê–ë–û–¢–ê–ï–¢: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ –ù–ê–°–¢–†–û–ï–ö –†–ê–ë–û–¢–ê–ï–¢: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (mistral)
```

---

## üìù –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. ‚úÖ **`rag_service.py`** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
2. ‚úÖ **`sql_agent_service.py`** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
3. ‚úÖ **`car_dealer_agent.py`** - –∞–≥–µ–Ω—Ç –¥–∏–ª–µ—Ä–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `_generate_with_ai_settings`)
4. ‚úÖ **`parameter_extraction_service.py`** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `_generate_with_ai_settings`)
5. ‚úÖ **`intelligent_search_service.py`** - –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `get_llm_for_task_async`)

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç!**  
**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤–µ–∑–¥–µ, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ò–ò!**  
**Fallback –Ω–∞ Ollama —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö Mistral!**

